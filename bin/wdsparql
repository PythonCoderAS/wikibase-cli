#!/usr/bin/env node
var simplifyResults = false
var args = process.argv.slice(2)

args = args.filter(function (arg) {
  if (arg === '-s' || arg === '--simplify' ) {
    simplifyResults = true
    return false
  } else {
    return true
  }
})

path = args[0]

var wdk = require('wikidata-sdk')
var request = require('request')
var fs = require('fs')

var sparql = fs.readFileSync(path, { encoding: 'utf-8' })
var url = wdk.sparqlQuery(sparql)

request(url, function (err, res) {
  if (err) {
    console.log(err)
  } else {
    results = res.body
    if (simplifyResults) {
      results = JSON.stringify(wdk.simplifySparqlResults(results), null, 2)
    }
    process.stdout.write(results)
  }
})
