#!/usr/bin/env node
const program = require('../lib/program')
program.process('data')
const wdk = require('../lib/customized_wdk')(program)
const _ = require('lodash')
const error_ = require('../lib/error')

const parseId = require('../lib/tolerant_id_parser')
const logNdjson = require('../lib/log_ndjson')
const ids = program.args.map(parseId)

if (!(ids && ids.length > 0)) return program.help()

const requestedIdsLenght = ids.length

ids.forEach(id => {
  if (!wdk.isEntityId(id)) throw new Error(`invalid entity id: ${id}`)
})

const lightGet = require('../lib/light_get')
const url = wdk.customize('getEntities', ids)

lightGet(url)
.then(body => {
  const entities = _.values(body.entities)
  if (requestedIdsLenght === 1) {
    console.log(JSON.stringify(entities[0]))
  } else {
    logNdjson(entities)
  }
})
.catch(error_.log)
